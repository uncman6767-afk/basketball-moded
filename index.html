<!DOCTYPE html>
<html>
<head>
<title>Basketball Bros MAX (Fixed)</title>
<style>
body{margin:0;background:#000;overflow:hidden}
canvas{display:block;margin:auto;background:linear-gradient(#1e90ff,#0b3d91)}
</style>
</head>
<body>

<canvas id="game" width="1000" height="520"></canvas>

<script>
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");

const keys={};
window.addEventListener("keydown",e=>keys[e.key.toLowerCase()]=true);
window.addEventListener("keyup",e=>keys[e.key.toLowerCase()]=false);

const GRAVITY=0.9,FLOOR=430;
let paused=false;

const player={
 x:200,y:350,w:40,h:70,
 vx:0,vy:0,
 speed:8,jump:20,
 stamina:100,score:0
};

const ai={
 x:700,y:350,w:40,h:70,
 vx:0,vy:0,score:0
};

const ball={
 x:0,y:0,vx:0,vy:0,
 held:true,owner:"player"
};

const hoop={x:900,y:220,w:50};

function resetBall(owner="player"){
 ball.held=true;
 ball.owner=owner;
 ball.vx=ball.vy=0;
}

function shoot(from){
 ball.held=false;
 ball.vx=from===player?14:-14;
 ball.vy=-15;
}

function updatePlayer(p,isAI=false){
 let speed=p.speed;

 if(!isAI){
  if(keys["shift"]&&p.stamina>0){
   speed=14;
   p.stamina-=1;
  }else{
   p.stamina+=0.5;
  }
  p.stamina=Math.max(0,Math.min(100,p.stamina));

  if(keys["a"]) p.vx=-speed;
  else if(keys["d"]) p.vx=speed;
  else p.vx*=0.8;

  if(keys["w"]&&p.y+p.h>=FLOOR){
   p.vy=-p.jump;
  }

  if(keys[" "]&&ball.held&&ball.owner==="player"){
   shoot(player);
  }
 }else{
  p.vx=(ball.x>p.x)?4:-4;
  if(Math.random()<0.01&&p.y+p.h>=FLOOR) p.vy=-18;
  if(ball.held&&ball.owner==="ai"&&Math.random()<0.02) shoot(ai);
 }

 p.vy+=GRAVITY;
 p.x+=p.vx;
 p.y+=p.vy;

 if(p.y+p.h>=FLOOR){
  p.y=FLOOR-p.h;
  p.vy=0;
 }
}

function update(){
 if(paused) return;

 updatePlayer(player,false);
 updatePlayer(ai,true);

 if(ball.held){
  const o=ball.owner==="player"?player:ai;
  ball.x=o.x+o.w/2;
  ball.y=o.y+25;
 }else{
  ball.vy+=GRAVITY;
  ball.x+=ball.vx;
  ball.y+=ball.vy;
 }

 if(ball.y>520) resetBall(ball.owner);

 if(
  ball.x>hoop.x &&
  ball.x<hoop.x+hoop.w &&
  ball.y>220 &&
  ball.y<235 &&
  ball.vy>0
 ){
  const pts=ball.x<700?2:3;
  if(ball.owner==="player") player.score+=pts;
  else ai.score+=pts;
  resetBall(ball.owner==="player"?"ai":"player");
 }
}

function draw(){
 ctx.clearRect(0,0,1000,520);

 ctx.fillStyle="#333";
 ctx.fillRect(0,FLOOR,1000,90);

 ctx.fillStyle="#ffcc00";
 ctx.fillRect(player.x,player.y,player.w,player.h);

 ctx.fillStyle="#ff4444";
 ctx.fillRect(ai.x,ai.y,ai.w,ai.w);

 ctx.fillStyle="orange";
 ctx.beginPath();
 ctx.arc(ball.x,ball.y,10,0,Math.PI*2);
 ctx.fill();

 ctx.fillStyle="red";
 ctx.fillRect(hoop.x,220,50,10);
 ctx.fillStyle="white";
 ctx.fillRect(hoop.x+40,180,8,80);

 ctx.fillStyle="white";
 ctx.font="20px Arial";
 ctx.fillText("YOU: "+player.score,20,30);
 ctx.fillText("AI: "+ai.score,20,55);

 ctx.fillStyle="lime";
 ctx.fillRect(20,70,player.stamina*2,8);
}

function loop(){
 update();
 draw();
 requestAnimationFrame(loop);
}
loop();

window.addEventListener("keydown",e=>{
 if(e.key.toLowerCase()==="p") paused=!paused;
 if(e.key.toLowerCase()==="r") re
